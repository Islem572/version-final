<!DOCTYPE html>
<html lang="fr">
<head>
    <!-- M√©tadonn√©es de base -->
    <meta charset="UTF-8"> <!-- Encodage UTF-8 pour les caract√®res sp√©ciaux -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Responsive design -->
    <title>Chatbot Frellio</title> <!-- Titre de la page -->
    <link rel="stylesheet" href="message.css"> <!-- Lien vers la feuille de style -->
</head>
<body>
    <!-- Conteneur principal du chat -->
    <div class="messagerie-container" style="width: 600px;">
        <!-- Fen√™tre de conversation -->
        <div class="fenetre-messages" style="width: 100%;">
            <!-- En-t√™te avec infos du bot -->
            <div class="entete-conversation">
                <div class="info-contact">
                    <div class="nom-contact">Frellio Bot ü§ñ</div> <!-- Nom + emoji -->
                    <div class="status">En ligne</div> <!-- Statut -->
                </div>
            </div>

            <!-- Zone d'affichage des messages -->
            <div class="corps-messages" id="corps-messages">
                <!-- Les messages seront inject√©s ici dynamiquement -->
            </div>

            <!-- Zone de saisie utilisateur -->
            <div class="zone-saisie">
                <input type="text" id="message-input" placeholder="√âcrivez votre message...">
                <button class="btn-envoyer" id="btn-envoyer">Envoyer</button>
            </div>
        </div>
    </div>

    <script>
        // Attendre que le DOM soit charg√©
        document.addEventListener("DOMContentLoaded", function () {
            // R√©cup√©ration des √©l√©ments DOM
            const messageInput = document.getElementById("message-input");
            const btnEnvoyer = document.getElementById("btn-envoyer");
            const corpsMessages = document.getElementById("corps-messages");

            // Gestionnaires d'√©v√©nements
            btnEnvoyer.addEventListener("click", envoyerMessage);
            messageInput.addEventListener("keypress", function (event) {
                if (event.key === "Enter") { // Envoi avec la touche Entr√©e
                    envoyerMessage();
                }
            });

            // Fonction d'envoi de message
            function envoyerMessage() {
                const texteMessage = messageInput.value.trim();
                if (texteMessage !== "") {
                    // Formatage de l'heure
                    const heureFormatee = getHeure();
                    
                    // Cr√©ation du HTML du message utilisateur
                    const messageHTML = `
                        <div class="message envoye">
                            <div class="contenu-message">
                                ${texteMessage}
                                <div class="heure-message">${heureFormatee}</div>
                            </div>
                        </div>
                    `;
                    
                    // Ajout du message √† la conversation
                    corpsMessages.innerHTML += messageHTML;
                    messageInput.value = ""; // Vidage du champ
                    corpsMessages.scrollTop = corpsMessages.scrollHeight; // D√©filement automatique

                    // Sauvegarde du message
                    sauvegarderMessage("utilisateur", texteMessage);

                    // Simulation de r√©ponse apr√®s 800ms
                    setTimeout(() => simulerReponse(texteMessage), 800);
                }
            }

            // Fonction pour obtenir l'heure actuelle format√©e
            function getHeure() {
                const maintenant = new Date();
                const heures = maintenant.getHours().toString().padStart(2, "0");
                const minutes = maintenant.getMinutes().toString().padStart(2, "0");
                return `${heures}:${minutes}`;
            }

            // Fonction de simulation de r√©ponse du bot
            function simulerReponse(messageUtilisateur) {
                const texte = messageUtilisateur.toLowerCase();
                let reponse = "Bonjour ! Je suis Frellio, comment puis-je vous aider ?"; // R√©ponse par d√©faut

                // R√©ponses conditionnelles bas√©es sur le contenu du message
                if (texte.includes("bonjour")) {
                    reponse = "Dans notre site vous pouvez trouver des informations sur nos produits et services.";
                } else if (texte.includes("heure")) {
                    const maintenant = new Date();
                    reponse = `Il est actuellement ${maintenant.getHours()}h${maintenant.getMinutes().toString().padStart(2, '0')}.`;
                } else if (texte.includes("merci")) {
                    reponse = "Avec plaisir ! üòä";
                } else if (texte.includes("comment √ßa va")) {
                    reponse = "Je vais bien, merci ! Et toi ?";
                }

                // Formatage et affichage de la r√©ponse
                const heureFormatee = getHeure();
                const reponseHTML = `
                    <div class="message recu">
                        <div class="contenu-message">
                            ${reponse}
                            <div class="heure-message">${heureFormatee}</div>
                        </div>
                    </div>
                `;
                corpsMessages.innerHTML += reponseHTML;
                corpsMessages.scrollTop = corpsMessages.scrollHeight;

                // Sauvegarde de la r√©ponse
                sauvegarderMessage("bot", reponse);
            }

            // Fonction d'envoi des messages au serveur
            function sauvegarderMessage(auteur, contenu) {
                fetch('save_message.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ auteur: auteur, contenu: contenu })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.status !== 'ok') {
                        console.error("Erreur lors de l'enregistrement du message :", data.message);
                    }
                });
            }
        });
    </script>
</body>
</html>